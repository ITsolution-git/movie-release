<div fxLayout="row" fxLayoutAlign="center center" class="page-header">
  <!-- Page Title -->
  <h2 fxFlex>
    <span *ngIf="userRole === 'editor'">My</span>
    <span *ngIf="userRole === 'admin'">Movie</span> Articles
  </h2>
  <!-- Add New Article Button -->
  <button class="add-btn" mat-raised-button color="primary" (click)="this.ars.openSelectMovieDialog()">
    <mat-icon>add</mat-icon> Add New
  </button>
</div>

<div fxLayout="column" fxFlex class="page-content">
  <!-- Article Search Field -->
  <mat-form-field class="artciles-search">
    <input matInput (keyup)="applyArticlesFilter($event.target.value)" placeholder="Search for Articles">
  </mat-form-field>

  <!-- Admin Articles Table -->
  <mat-table #articlesTable [dataSource]="articlesDataSource" matSort class="artciles-table">
    <!-- Article Title -->
    <ng-container matColumnDef="article-title" mat-sort-header>
      <mat-header-cell *matHeaderCellDef> Article Title </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.article_title }}
      </mat-cell>
    </ng-container>
    <!-- Movie Title -->
    <ng-container matColumnDef="movie-title" mat-sort-header>
      <mat-header-cell *matHeaderCellDef> Movie Title </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.article_movie_title }}
      </mat-cell>
    </ng-container>
    <!-- Article Owner -->
    <ng-container matColumnDef="article-owner" mat-sort-header>
      <mat-header-cell *matHeaderCellDef> Owner</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.article_owner_name }}
      </mat-cell>
    </ng-container>
    <!-- Article Date -->
    <ng-container matColumnDef="date" mat-sort-header>
      <mat-header-cell *matHeaderCellDef> Date</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.article_date | date:'M/d/yy' }}
      </mat-cell>
    </ng-container>
    <!-- Article Status -->
    <ng-container matColumnDef="status" mat-sort-header>
      <mat-header-cell *matHeaderCellDef> Status</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.article_status }}
      </mat-cell>
    </ng-container>
    <!-- User Actions -->
    <ng-container matColumnDef="user-actions">
      <mat-header-cell *matHeaderCellDef></mat-header-cell>
      <mat-cell *matCellDef="let row">
        <span class="more" [matMenuTriggerFor]="actionMenu">
          <mat-icon>more_vert</mat-icon>
        </span>
        <mat-menu #actionMenu="matMenu" [overlapTrigger]="false">
          <button mat-menu-item (click)="goToArticleEditPage(row.article_key)">
            <span>
              <mat-icon>edit</mat-icon> Edit
            </span>
          </button>
          <button mat-menu-item (click)="openDeleteDialog(row.article_key)">
            <span>
              <mat-icon>close</mat-icon> Delete
            </span>
          </button>
          <button *ngIf="row.article_status === 'draft' && userRole === 'admin'" mat-menu-item (click)="toggleArticleStatus(row.article_key, 'public')">
            <span>
              <mat-icon>visibility</mat-icon> Publish
            </span>
          </button>
          <button *ngIf="row.article_status === 'public' && userRole === 'admin'" mat-menu-item (click)="toggleArticleStatus(row.article_key, 'draft')">
            <span>
              <mat-icon>visibility_off</mat-icon>Unpublish
            </span>
          </button>
        </mat-menu>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="adminColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: adminColumns;"></mat-row>
  </mat-table>
  
  <!-- No Results -->
  <div *ngIf="articlesList?.length < 1" fxFlex fxLayoutAlign="center center" class="no-results">No Articles found!</div>

  <!-- Paginator -->
  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10"></mat-paginator>
</div>

<!-- Loader -->
<div fxLayout="row" fxLayoutAlign="center center" *ngIf="loading" class="loader" fxFlexLayoutAlign="center center">
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</div>